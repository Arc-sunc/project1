const danceData = {
  kerala: {
    stateName: 'Kerala',
    stateCode: 'IN-KL',
    dances: [
      {
        name: 'Margamkali',
        description:
          'Margamkali is a traditional folk dance of Kerala performed mainly by the Syrian Christian community. It is usually performed by women dressed in white, dancing in a circle around a lit lamp while singing songs that tell the story of St. Thomas. Margamkali reflects devotion, cultural identity, and the harmony of Kerala’s diverse traditions.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/0/03/Margamkali.jpg'
      },
      {
        name: 'Thiruvathirakali',
        description:
          'Thiruvathirakali, is a graceful traditional dance of Kerala performed by women during the Thiruvathira festival in the Malayalam month of Dhanu. The dancers form a circle around a lit lamp (nilavilakku) and move rhythmically to melodious folk songs, celebrating womanhood, devotion, and the divine union of Goddess Parvati and Lord Shiva.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/4/43/Thiruvathirakali_kerala.jpg'
      },
      {
        name: 'Kolkali',
        description:
          'Kolkali is a folk art performed in the Malabar region of Kerala, India. The dance performers move in a circle, striking small sticks and keeping rhythm with special steps. The circle expands and contracts as the dance progress. The accompanying music gradually rises in pitch and the dance reaches its climax.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Kolkali-Parichakali_folk_dance.jpg'
      }
    ]
  },
  maharashtra: {
    stateName: 'Maharashtra',
    stateCode: 'IN-MH',
    dances: [
      {
        name: 'Koli Dance',
        description:
          'The Koli Dance originates from the Koli fisherfolk community of Maharashtra. It reflects their daily life and work, such as rowing boats, casting nets, and battling sea waves. Performed in pairs, the dance captures the rhythm of the sea and the joy of fishing. Traditional Marathi songs and clapping accompany the movements, celebrating the community’s unity and lively spirit.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/7/7b/Koli_Folk_Dance_of_Maharashtra.jpg'
      },
      {
        name: 'Dindi Wari Dance',
        description:
          'The Dindi Wari Dance is a devotional folk dance dedicated to Lord Vithoba of Pandharpur. It is performed during the Ekadashi festival by devotees known as Warkaris. The dancers move in circles, singing abhangas (devotional hymns) and expressing deep faith and joy. This dance reflects the spiritual devotion and cultural unity of Maharashtra’s pilgrimage tradition.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/e/e1/Ai_dindi_warkari_group_photo.jpg'
      },
      {
        name: 'Lezim Dance',
        description:
          'Lezim Dance is a vibrant and energetic folk dance of Maharashtra, performed using a small jingling instrument called the Lezim. It features quick, synchronized steps, rhythmic movements, and dynamic group formations. Commonly seen in festivals, parades, and fitness events, the Lezim Dance symbolizes strength, coordination, and the festive energy of the people.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/4/44/Lezim-dancers.jpg'
      }
    ]
  },
  haryana: {
    stateName: 'Haryana',
    stateCode: 'IN-HR',
    dances: [
      {
        name: 'Jhumar',
        description:
          'Jhumar is a graceful folk dance popular in Haryana, Punjab, and parts of Rajasthan. It features gentle, rhythmic movements in circular patterns to the tune of soft music and songs of love and happiness. The dance is often performed after harvests and during festive gatherings, symbolizing joy and prosperity.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/b/bf/Jumar_Dance.jpg'
      },
      {
        name: 'Gugga Dance',
        description:
          'The Gugga dance is a traditional folk dance of Haryana and parts of Rajasthan, performed in honor of Gugga Pir, a local deity believed to protect against snakebites. Devotees dance energetically to the beat of drums and folk songs during processions and fairs, reflecting deep faith and community devotion.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/4/43/2017-02-05_15-24-50_carnaval-riedisheim.jpg'
      },
      {
        name: 'Phag or Phalgun',
        description:
          'The Phag or Phalgun dance is a lively folk dance of Haryana, performed during the month of Phalgun (February–March) to celebrate the arrival of spring and the harvest season. Men and women dance together with joyful movements and songs that express love, happiness, and the spirit of rural life.',
        image: './assets/images/phag.jpg'
      }
    ]
  },
  mizoram: {
    stateName: 'Mizoram',
    stateCode: 'IN-MZ',
    dances: [
      {
        name: 'Khuallam Dance',
        description:
          'The Khuallam Dance, is a popular Mizo community dance performed during festivals and social gatherings. Traditionally, it was performed to welcome honored guests who had traveled from distant villages. Dancers, usually men, wear traditional Puandum (a handwoven shawl) and move energetically in rhythmic steps to the beats of drums and gongs. The dance reflects the Mizo values of friendship, hospitality, and community spirit.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/9/9d/A_group_of_dancers_from_Mizoram_performing_%22Khuallam%22_dance_at_the_Republic_Day_Folk_Dance_Festival_2004_which_was_inaugurated_by_the_President_Dr._A.P.J_Abdul_Kalam_in_New_Delhi_on_January_24%2C_2004.jpg'
      },
      {
        name: 'Cheraw Dance',
        description:
          'The Cheraw Dance, also known as the Bamboo Dance, is one of the oldest and most famous traditional dances of Mizoram in Northeast India. It is performed by men who rhythmically clap long bamboo staves while women dancers step in and out of the moving bamboos with graceful and precise movements. Traditionally, it was performed to celebrate successful harvests or marriage ceremonies, but today it is often showcased at cultural festivals.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Cheraw_Mizoram.jpg'
      },
      {
        name: 'Tlanglam Dance',
        description:
          'The Tlanglam Dance is a vibrant and elegant Mizo group dance that symbolizes joy and unity. It is performed by both men and women dressed in colorful traditional attire, moving in well-coordinated patterns to the rhythm of traditional instruments. Originally performed during festive occasions and village celebrations, the dance represents harmony and the collective spirit of the Mizo people.',
        image: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=80'
      }
    ]
  },
  bengal: {
    stateName: 'Bengal',
    stateCode: 'IN-WB',
    dances: [
      {
        name: 'Dhunuchi Dance',
        description:
          'The Dhunuchi dance is a devotional dance performed during Durga Puja in West Bengal. Dancers hold earthen incense burners (dhunuchis) filled with burning coconut husk and incense, moving rhythmically to the beats of the dhak (traditional drum) as an offering to Goddess Durga. It symbolizes devotion, energy, and festive spirit.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/d/d2/Traditional_Dhunuchi_Dance.jpg'
      },
      {
        name: 'Bratachari Kathi Nach',
        description:
          'The Bratachari Kathi Nach is a vigorous folk dance from Bengal, associated with the Bratachari movement founded by Gurusaday Dutt. Dancers perform rhythmic steps using small sticks (kathi), promoting discipline, unity, and national pride. The dance combines physical fitness with cultural expression.',
        image: './assets/images/bratach.jpg'
      },
      {
        name: 'Rabindra Sangeet Dance',
        description:
          'The Rabindra Sangeet dance is a graceful dance form performed to the songs written and composed by Rabindranath Tagore. It blends classical and folk styles, expressing deep emotions, nature, and human values. The dance reflects the beauty and philosophy of Tagore’s music and poetry.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/0/0a/Dance_with_Rabindra_Sangeet_-_Kolkata_2011-11-05_6669.JPG'
      }
    ]
  },
  tamilnadu: {
    stateName: 'Tamil Nadu',
    stateCode: 'IN-TN',
    dances: [
      {
        name: 'Kolattam',
        description:
          'Kolattam dance is a traditional dance from south india performed primarily by women. It is also known as the stick dance and is popular in the states of Andhra Pradesh, Tamil Nadu and Karnataka. The dance involves rhythmic hitting of sticks accompanied by folk music. Kolattam is usually performed during festivals and special occasions, symbolizing community and togetherness.',
        image: './assets/images/kolattam.jpg'
      },
      {
        name: 'Kummi',
        description:
          'The Kummi is one of the oldest folk dances of Tamil Nadu, performed mainly by women who stand in a circle and clap their hands rhythmically while singing traditional songs. It is often performed during festivals and harvest celebrations, symbolizing community harmony and happiness.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/8/83/Kummi.jpg'
      },
      {
        name: 'Oyilattam',
        description:
          'The Oyilattam, meaning “Dance of Grace,” is a folk dance of Tamil Nadu performed by men (and sometimes women) in colorful costumes, accompanied by drums and traditional music. Dancers move rhythmically in rows or circles, combining graceful steps with energetic movements that express joy and celebration.',
        image: 'https://upload.wikimedia.org/wikipedia/commons/8/80/OYILATTAM_%28Tamil_culture%29.jpg'
      }
    ]
  }
};

const stateInfoPanel = document.getElementById('stateInfo');
const stateCardsContainer = document.getElementById('stateCards');

const renderInfoPanel = (stateKey) => {
  const state = danceData[stateKey];
  if (!state) return;
  const dancesMarkup = state.dances
    .map(
      (dance) => `
        <div class="info-dance">
          <div class="info-dance-image" style="background-image:url('${dance.image}')"></div>
          <div>
            <h4>${dance.name}</h4>
            <p>${dance.description}</p>
          </div>
        </div>`
    )
    .join('');
  stateInfoPanel.innerHTML = `
    <h3>${state.stateName}</h3>
    <p>Spin and sway through every folk rhythm from ${state.stateName}.</p>
    ${dancesMarkup}`;
  if (window.AOS && typeof window.AOS.refresh === 'function') {
    window.AOS.refresh();
  }
};

const renderCards = () => {
  if (!stateCardsContainer) return;
  const animations = ['fade-up', 'fade-right', 'fade-left', 'zoom-in'];
  let cardIndex = 0;
  Object.values(danceData).forEach((state) => {
    state.dances.forEach((dance) => {
      const card = document.createElement('article');
      card.className = 'state-card';
      const animationType = animations[cardIndex % animations.length];
      card.setAttribute('data-aos', animationType);
      card.setAttribute('data-aos-delay', (cardIndex % 5) * 70);
      card.setAttribute('data-aos-duration', 800 + (cardIndex % 4) * 120);
      card.innerHTML = `
        <img src="${dance.image}" alt="${dance.name}" loading="lazy" />
        <div class="state-card-content">
          <span class="state-label">${state.stateName}</span>
          <h4>${dance.name}</h4>
          <p>${dance.description}</p>
        </div>`;
      stateCardsContainer.appendChild(card);
      cardIndex += 1;
    });
  });
  if (window.AOS && typeof window.AOS.refreshHard === 'function') {
    window.AOS.refreshHard();
  }
};

const setupScrollButtons = () => {
  document.querySelectorAll('[data-scroll]').forEach((trigger) => {
    trigger.addEventListener('click', () => {
      const target = document.querySelector(trigger.dataset.scroll);
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
};

const initMap = () => {
  if (typeof am5 === 'undefined' || !document.getElementById('indiaMap')) return;
  am5.ready(function () {
    const root = am5.Root.new('indiaMap');
    root.setThemes([am5themes_Animated.new(root)]);

    const chart = root.container.children.push(
      am5map.MapChart.new(root, {
        panX: 'none',
        panY: 'none',
        wheelY: 'none',
        projection: am5map.geoMercator(),
        paddingTop: 0,
        paddingBottom: 0,
        paddingLeft: 0,
        paddingRight: 0
      })
    );

    const polygonSeries = chart.series.push(
      am5map.MapPolygonSeries.new(root, {
        geoJSON: am5geodata_india2019Low,
        exclude: ['IN-LK', 'IN-PK'],
        valueField: 'value'
      })
    );

    const highlightStates = Object.values(danceData).map((state) => state.stateCode);
    let currentStateKey = null;
    const calmColor = am5.color(0xfbe3d3);
    const baseColor = am5.color(0xe76432);
    const focusColor = am5.color(0xffb347);

    polygonSeries.mapPolygons.template.setAll({
      tooltipText: '{name}',
      interactive: true,
      stroke: am5.color(0xffffff),
      strokeWidth: 0.7,
      fill: calmColor,
      cursorOverStyle: 'pointer',
      fillOpacity: 0.95
    });

    polygonSeries.mapPolygons.template.states.create('hover', {
      fill: am5.color(0xffc46c),
      strokeWidth: 1.2
    });

    polygonSeries.mapPolygons.template.adapters.add('fill', (fill, target) => {
      const id = target.dataItem?.dataContext?.id;
      if (highlightStates.includes(id)) {
        return baseColor;
      }
      return calmColor;
    });

    const animateFill = (polygon, color, duration = 600) => {
      if (!polygon) return;
      polygon.animate({
        key: 'fill',
        to: color,
        duration,
        easing: am5.ease.out(am5.ease.cubic)
      });
    };

    const focusState = (polygon) => {
      const id = polygon.dataItem?.dataContext?.id;
      const stateKey = Object.keys(danceData).find((key) => danceData[key].stateCode === id);
      if (!stateKey || stateKey === currentStateKey) return;
      currentStateKey = stateKey;
      renderInfoPanel(stateKey);
      polygonSeries.mapPolygons.each((poly) => {
        const polyId = poly.dataItem?.dataContext?.id;
        if (highlightStates.includes(polyId)) {
          animateFill(poly, poly === polygon ? focusColor : baseColor, poly === polygon ? 650 : 500);
        }
      });
    };

    polygonSeries.mapPolygons.template.events.on('pointerover', (event) => {
      const polygon = event.target;
      const id = polygon.dataItem?.dataContext?.id;
      if (highlightStates.includes(id)) {
        animateFill(polygon, focusColor, 450);
        focusState(polygon);
      }
    });

    polygonSeries.mapPolygons.template.events.on('pointerout', (event) => {
      const polygon = event.target;
      const id = polygon.dataItem?.dataContext?.id;
      if (highlightStates.includes(id)) {
        const matchesSelection =
          currentStateKey && danceData[currentStateKey]?.stateCode === id;
        animateFill(polygon, matchesSelection ? focusColor : baseColor, 550);
      }
    });

    polygonSeries.mapPolygons.template.events.on('click', (event) => {
      const polygon = event.target;
      const id = polygon.dataItem?.dataContext?.id;
      if (highlightStates.includes(id)) {
        focusState(polygon);
      }
    });

    chart.appear(1000, 200);
    polygonSeries.appear(1000, 200);
  });
};

const initPage = () => {
  document.body.classList.add('page-loaded');
  if (window.AOS) {
    AOS.init({ duration: 900, once: true, offset: 120 });
  }
  setupScrollButtons();
  renderCards();
  initMap();
};

document.addEventListener('DOMContentLoaded', initPage);
